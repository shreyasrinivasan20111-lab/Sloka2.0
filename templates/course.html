{% extends "base.html" %}

{% block title %}Course - Sai Kalpataru Vidyalaya{% endblock %}

{% block content %}
<div class="text-center mb-4">
    <h1 class="main-title" id="course-title">Course</h1>
    <p class="lead">Traditional Vedic Learning</p>
</div>

<div class="row">
    <div class="col-2">
        <div class="materials-section">
            <h2>Course Materials</h2>
            <div class="materials-grid">
                <div class="material-type">
                    <div id="lyrics-materials">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading lyrics...</p>
                        </div>
                    </div>
                    
                    <!-- Admin upload for lyrics -->
                    <div class="admin-only mt-3">
                        <h5>Upload Lyrics</h5>
                        <div class="file-upload" id="lyrics-upload">
                            <p>Click to upload lyrics files</p>
                            <input type="file" id="lyrics-file-input" accept=".txt,.pdf,.doc,.docx" style="display: none;">
                        </div>
                    </div>
                </div>
                
                <div class="material-type">
                    <div id="recordings-materials">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading recordings...</p>
                        </div>
                    </div>
                    
                    <!-- Admin upload for recordings -->
                    <div class="admin-only mt-3">
                        <h5>Upload Recordings</h5>
                        <div class="file-upload" id="recordings-upload">
                            <p>Click to upload audio files</p>
                            <input type="file" id="recordings-file-input" accept=".mp3,.wav,.m4a,.ogg" style="display: none;">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-2">
        <div class="timer-container">
            <h2>Time Tracking</h2>
            <div class="timer-display" id="timer-display">00:00:00</div>
            <div class="timer-controls">
                <button class="btn btn-success" id="start-timer">Start</button>
                <button class="btn btn-danger" id="stop-timer" disabled>Stop</button>
                <button class="btn btn-secondary" id="restart-timer" disabled>Restart</button>
            </div>
            <div class="mt-3">
                <p class="text-sm text-muted">Track your study time for this course. Your progress will be automatically saved.</p>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col">
        <div class="card">
            <div class="card-header">
                <h3>Course Information</h3>
            </div>
            <div class="p-3">
                <p>This course is part of the traditional Vedic learning curriculum designed to deepen your understanding of Sanatana Dharma.</p>
                <p><strong>Instructions:</strong></p>
                <ul>
                    <li>Download and study the provided lyrics materials</li>
                    <li>Listen to the recordings to learn proper pronunciation</li>
                    <li>Use the timer to track your study sessions</li>
                    <li>Practice regularly for best results</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col">
        <div class="card">
            <div class="card-header">
                <h3>Navigation</h3>
            </div>
            <div class="p-3">
                <a href="/dashboard" class="btn btn-primary">Back to Dashboard</a>
                <a href="/admin" class="btn btn-secondary admin-only">Admin Dashboard</a>
                <a href="/" class="btn btn-secondary">Home</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    // Check if user is logged in
    if (!authToken) {
        window.location.href = '/login';
        return;
    }
    
    // Get course ID from URL
    const courseId = getCurrentCourseId();
    if (!courseId) {
        window.location.href = '/dashboard';
        return;
    }
    
    // Load course name
    makeAPICall('/api/courses').then(courses => {
        const course = courses.find(c => c.id === courseId);
        if (course) {
            $('#course-title').text(course.name);
            document.title = `${course.name} - Sai Kalpataru Vidyalaya`;
        }
    }).catch(error => {
        console.error('Error loading course info:', error);
    });
    
    // Hide admin-only elements for non-admin users
    if (!currentUser || !currentUser.is_admin) {
        $('.admin-only').hide();
    }
});
</script>
{% endblock %}
